
<button id="buzz" style="position:absolute;top:200px;right:500px; width:300px; height:40px;">Гудок</button>
 <button id="wobble" style="position:absolute;top:300px;right:500px; width:300px; height:40px;">Качели</button>

<button id="pop" style="position:absolute;top:120px;right:500px; width:300px; height:40px; transition: all 0.3s ease-in-out;">Напоказ/Выскочка</button>  

<button id="color" class="pop">Градиент</button>
<button class="pulse">Пульс</button>

{%csrf_token%}
<form class="sortable" hx-trigger="end" hx-post="/sort" hx-target="#blocks">
        {%for block in blocks%}
        <div>
            <li>
                {%if block.active%}

                <input type="checkbox" name="active" id="active" class="active" onChange="blockActivity('{{block.uid}}')" checked>
                {%else%}
                <input type="checkbox" name="active" id="active" class="active" onChange="blockActivity('{{block.uid}}')">
                {%endif%}
                
                <input type="hidden" name="block_order" value="{{block.pk}}">
                
                {% if block.link%}
                <input class="title" name="title" value="{{block.link.title}}" id="{{block.uid}}" placeholder="Заголовок" onfocusout="updateTitle(this.id,this.value)">
                <input name="url" class='url' value="{{block.link.url}}" id="{{block.uid}}" placeholder="Ссылка" onfocusout="updateURL(this.id,this.value)">
               
                <div class="functions">
                    <ul>
                        <li>
                            <!-- Prioritize -->
                            <div style="width:20px;height:20px;">
                                <svg viewBox="0 0 16 16" display="block" enable-background="new 0 0 24 24" class="sc-guxjaN hBQDCy"><g><path fill-rule="evenodd" clip-rule="evenodd" d="M1 5C1 3.34315 2.34315 2 4 2C5.65685 2 7 3.34315 7 5V8H4C2.34315 8 1 6.65685 1 5ZM4 1C6.20914 1 8 2.79086 8 5V8H13.7929L11.1464 5.35355L11.8536 4.64645L15.3536 8.14645V8.85355L11.8536 12.3536L11.1464 11.6464L13.7929 9H8V16H7V9H4C1.79086 9 0 7.20914 0 5C0 2.79086 1.79086 1 4 1Z" fill="currentColor"></path></g></svg>
                            </div>
                            <label>Prioritize</label>
                            <div>
                                <ul>
                                    <li>
                                        <input type="radio" name="priority" id="linkAnimation">
                                        <div class="priority-explanation">
                                            <p>

                                            </p>
                                            <p>

                                            </p>
                                        </div>  
                                    </li>
                                    {%if block.music%}
                                    {%endif%}
                                    <li>
                                        <input type="radio" name="priority" id="linkNoPriority">
                                        <div class="priority-explanation">
                                            <p>

                                            </p>
                                            <p>

                                            </p>
                                        </div>  
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <!-- Thumbnail -->
                        </li>
                        <li>
                            <!-- Redirect -->
                        </li>
                        <li>
                            <!-- Lock -->
                        </li>
                        <li>
                            <!-- Schedule -->
                        </li>
                        <li>
                            <!-- Analytics -->
                        </li>
                    </ul>
                </div>
                <div id="urlError" style="display:none;">
                    <p>Пожалуйста, введите корректную ссылку.</p>
                </div>
                    <button hx-delete="{%url 'link:delete-block' block.uid%}" hx-target="#blocks">Delete</button>
                {% endif%}
            </li>
            
        </div>
        {%empty%}
        {%endfor%}
    <style>
        .pop{
            position: absolute;
            top:450px;
            right:300px;
            width:300px; 
            height:40px; 
            transition: all 2s;
            background-color:blue;
            transition: background 0.5s linear; 
        }
    </style>
    <style>
    
    .pulse {
        position:absolute;
        top:350px;
        right:250px;
        background: black;
        color:white;
        border-radius: 20px;
        box-shadow: 0 0 0 0 rgba(0, 0, 0, 1);
        margin: 10px;
        height: 40px;
        width: 300px;
        transform: scale(1);
        animation: pulse-black 2s infinite;
    }

@keyframes pulse-black {
	0% {
		transform: scale(1);
		box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.7);
	}
	
	70% {
		transform: scale(1.05);
		box-shadow: 0 0 0 10px rgba(0, 0, 0, 0);
	}
	
	100% {
		transform: scale(1);
		box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
	}
}
    </style>
    <script>

        document.body.addEventListener('htmx:configRequest',(event)=>{
            event.detail.headers['X-CSRFToken']="{{csrf_token}}";
        })
        
        /* Pop */
        
        function pop(){
            $('#pop').css({'transform':'scale(1.05)'});
            setTimeout(popDown,300)
        }
        function popDown(){
            $('#pop').css({'transform':'scale(1)'});
            setTimeout(pop,2000);
        }
        pop();


        /* Wobble */

        function wobble() {
            $('#wobble').animate({'marginTop': '+=2.5'}, 150)
            .animate({'marginTop':'-=5'},150)
            .animate({'marginTop':'+=5'},150)
            .animate({'marginTop':'-=5'},150)
            .animate({'marginTop':'+=5'},150)
            .animate({'marginTop':'-=3.5'},150)
            .animate({'marginTop':'+=3.5'},150)
            .animate({'marginTop':'-=2.5'},150)
                 .animate({'marginTop': '+=2.5'}, 175, function() {
                     setTimeout(wobble, 1500);
                 });
        }
        wobble();

/* Buzz */

        function buzz(degrees,dur){
            $('#buzz').animate(
                { deg: degrees },
                {
                duration: dur,
                step: function(now) {
                    $(this).css({ transform: 'rotate(' + now + 'deg)' });
                }
                
                }
            );
        }
        rotation=1;
        duration=100;
        function buzzLoop(){
            buzz(rotation,duration);
            buzz(-rotation,duration);
            buzz(rotation,duration);
            buzz(-rotation,duration);
            buzz(0,duration);
            setTimeout(buzzLoop,2000)
        }
        buzzLoop();
        
        /* Color change */
        colors=['red','blue','green','yellow']     
        function gradient(){
            colors.forEach(function(color){
                $('#color').animate({
                backgroundColor:color,
                }).delay(500);
            });
            gradient();     
        }
        gradient();
        function blockActivity(uid){
            $.ajax({
            url:"{%url 'link:block-activity'%}",
            data:{
                "csrfmiddlewaretoken":"{{csrf_token}}",
                'uid':uid,
            },
            method:"POST",
            });
        };
        function updateTitle(uid,title){
            $.ajax({
            url:"{%url 'link:update-title'%}",
            data:{
                "csrfmiddlewaretoken":"{{csrf_token}}",
                'uid':uid,
                'title':title,
            },
            method:"POST",
            });
        };
        function updateURL(uid,url){
            if(/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test( url )===true){
                document.getElementById('urlError').style.display='none';
                $.ajax({
                url:"{%url 'link:update-url'%}",
                    data:{
                        "csrfmiddlewaretoken":"{{csrf_token}}",
                        'uid':uid,
                        'url':url,
                    },
                    method:"POST",
                });
            }
            else if(url==''){
                document.getElementById('urlError').style.display='none';
            }
            else{
                document.getElementById('urlError').style.display='';
            }    
        };
    </script>
